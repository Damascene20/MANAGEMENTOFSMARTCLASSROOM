{% extends "base.html" %}

{% block head %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
<style>
    /* --- FIXED TABLE TO FIT SCREEN (NO SCROLL BAR) --- */
    .table-responsive { 
        overflow-x: hidden; 
        width: 100%;
    }

    .table th, .table td { 
        font-size: 0.75rem; 
        padding: 6px 8px; 
        vertical-align: middle; 
        text-align: center; 
        word-wrap: break-word; 
        white-space: normal;   
        max-width: 120px;      
    }

    .badge { font-size: 0.65rem; padding: 3px 6px; }
    .btn-sm { font-size: 0.65rem; padding: 2px 6px; }
    .card { 
        max-width: 100%; 
        margin: 10px auto; 
        border-radius: 10px; 
        box-shadow: 0 3px 8px rgba(0,0,0,0.1); 
    }

    h2 { font-size: 1.5rem; }
    p { font-size: 0.8rem; }
    .alert { font-size: 0.8rem; padding: 8px 12px; }

    /* --- Responsive adjustments --- */
    @media (max-width: 992px) {
        h2 { font-size: 1.3rem; }
        p, .alert { font-size: 0.75rem; }
        .table th, .table td { font-size: 0.7rem; padding: 4px 5px; max-width: 90px; }
        .btn-sm { font-size: 0.6rem; padding: 2px 4px; }
    }

    @media (max-width: 600px) {
        .table td form, .table td a {
            display: block;
            margin-bottom: 3px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-12">
        <h2 class="mb-3 text-center text-dark">Teacher Account Management üßë‚Äçüè´</h2>
        <p class="text-center text-secondary mb-3">
            Review and manage all registered teacher accounts and their approval status.
        </p>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} text-center" role="alert">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="card shadow-sm">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">All Registered Teachers</h5>
                <span class="badge bg-secondary fs-6">Total: {{ total_teachers }}</span>
            </div>

            <div class="card-body p-0">
                {% if teachers | length == 0 %}
                <div class="alert alert-info text-center m-3" role="alert">
                    <i class="bi bi-info-circle-fill me-1"></i> No teacher accounts have been registered yet.
                </div>
                {% else %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover mb-0 align-middle">
                        <thead class="table-primary text-center">
                            <tr>
                                <th>ID</th>
                                <th>Name</th>
                                <th>Subject</th>
                                <th>Email</th>
                                <th>Phone</th>
                                <th>Class</th>
                                <th>Username</th>
                                <th>Role</th>
                                <th>Status</th>
                                <th>Action</th>
                                <th>Edit</th>
                                <th>Delete</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for teacher in teachers %}
                            <tr>
                                <td>{{ teacher[0] }}</td>
                                <td>{{ teacher[1] }}</td>
                                <td>{{ teacher[2] }}</td> 
                                <td>{{ teacher[6] }}</td>
                                <td>{{ teacher[7] }}</td>
                                <td>{{ teacher[8] }}</td>
                                <td>{{ teacher[3] }}</td>
                                <td>
                                    <span class="badge bg-{{ 'danger' if teacher[4]=='ICT_Admin' else 'info' }}">{{ teacher[4] }}</span>
                                </td>
                                <td>
                                    {% if teacher[5] == 1 %}
                                    <span class="badge bg-success"><i class="bi bi-check-circle-fill"></i> Approved</span>
                                    {% elif teacher[5] == 2 %}
                                    <span class="badge bg-danger"><i class="bi bi-x-circle-fill"></i> Denied</span>
                                    {% else %} 
                                    <span class="badge bg-warning text-dark"><i class="bi bi-clock-fill"></i> Pending</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if teacher[4] == 'ICT_Admin' %}
                                        <span class="text-secondary fw-bold">Admin</span>
                                    {% elif teacher[5] == 1 %}
                                        <form method="POST" action="{{ url_for('approve_teacher_account', teacher_id=teacher[0], action='deny') }}" class="d-inline">
                                            <button type="submit" class="btn btn-sm btn-danger"><i class="bi bi-x"></i> Deny</button>
                                        </form>
                                    {% else %}
                                        <form method="POST" action="{{ url_for('approve_teacher_account', teacher_id=teacher[0], action='approve') }}" class="d-inline me-1">
                                            <button type="submit" class="btn btn-sm btn-success"><i class="bi bi-check"></i> Approve</button>
                                        </form>
                                        {% if teacher[5] != 2 %}
                                            <form method="POST" action="{{ url_for('approve_teacher_account', teacher_id=teacher[0], action='deny') }}" class="d-inline">
                                                <button type="submit" class="btn btn-sm btn-warning"><i class="bi bi-x"></i> Deny</button>
                                            </form>
                                        {% endif %}
                                    {% endif %}
                                </td>
                                <td>
                                    <a href="{{ url_for('edit_teacher_page', teacher_id=teacher[0]) }}" class="btn btn-sm btn-info"><i class="bi bi-pencil-square"></i> Edit</a>
                                </td>
                                <td>
                                    {% if teacher[4]!='ICT_Admin' %}
                                    <form method="POST" action="{{ url_for('delete_teacher_account', teacher_id=teacher[0]) }}" class="d-inline" onsubmit="return confirm('Are you sure you want to delete {{ teacher[1] }}?');">
                                        <button type="submit" class="btn btn-sm btn-danger"><i class="bi bi-trash"></i> Delete</button>
                                    </form>
                                    {% else %}
                                    <span class="text-danger fw-bold">Admin</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Full Pagination with Page Numbers -->
        <nav aria-label="Page navigation" class="mt-3">
          <ul class="pagination justify-content-center">
            <!-- Previous Button -->
            <li class="page-item {% if page <= 1 %}disabled{% endif %}">
              {% if page > 1 %}
                <a class="page-link" href="{{ url_for('manage_teachers', page=page-1) }}">Previous</a>
              {% else %}
                <span class="page-link">Previous</span>
              {% endif %}
            </li>

            <!-- Page Numbers -->
            {% for p in range(1, total_pages + 1) %}
              <li class="page-item {% if p == page %}active{% endif %}">
                <a class="page-link" href="{{ url_for('manage_teachers', page=p) }}">{{ p }}</a>
              </li>
            {% endfor %}

            <!-- Next Button -->
            <li class="page-item {% if page >= total_pages %}disabled{% endif %}">
              {% if page < total_pages %}
                <a class="page-link" href="{{ url_for('manage_teachers', page=page+1) }}">Next</a>
              {% else %}
                <span class="page-link">Next</span>
              {% endif %}
            </li>
          </ul>
        </nav>

    </div>
</div>
{% endblock %}
